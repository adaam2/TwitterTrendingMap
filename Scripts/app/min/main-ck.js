function buildTweetWindow(e){var t=new Date(e.CreatedAt),o=t.getDate(),n=t.getMonth()+1,a=t.getFullYear(),s=t.toTimeString(),r=o+"/"+n+"/"+a,i='<div class="tweet">        <div class="header">        <div class="avatar"><a target="_blank" href="https://www.twitter.com/'+e.User+'"><img src="'+e.ImageUrl+'" alt="'+e.User+'s profile picture"/></a></div>        <div class="screen-name"><span class="handle">@'+e.User+'</span><span class="time-ago"><time class="timeago" datetime="'+e.CreatedAt+'">'+r+'</time></span></div>        </div>        <div class="body"><p>'+e.Text+'</p></div>        <div class="footer">'+r+" "+s+"</div>        </div>";return i}function subscribeGlobalStream(){twitterHub.server.subscribeToStreamGroup("Global").done(function(e){e===!0&&(startBtn.prop("disabled",!0),stopBtn.prop("disabled",!1))})}function unsubscribeGlobalStream(){twitterHub.server.unsubscribeFromStreamGroup("Global").done(function(){stopBtn.prop("disabled",!0),startBtn.prop("disabled",!1)})}var map,mc,guids=[],counter=0,bounds=new google.maps.LatLngBounds,twitterHub=$.connection.geoFeedHub,startBtn=$("#startStream"),stopBtn=$("#stopStream"),svgshape=document.getElementById("notification-shape"),stylez=[{featureType:"road",elementType:"geometry",stylers:[{lightness:100},{visibility:"simplified"}]},{featureType:"water",elementType:"geometry",stylers:[{visibility:"on"},{color:"#C6E2FF"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#C5E3BF"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#D1D1B8"}]}],map_options={zoom:7,backgroundColor:"#A3A3A3",disableDoubleClickZoom:!0,center:new google.maps.LatLng(53,-.2),mapTypeID:google.maps.MapTypeId.HYBRID,keyboardShortcuts:!1,overviewMapControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP]},panControl:!1,scrollwheel:!1,streetViewControl:!1,styles:stylez},guid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()}}();$(function(){$("#autocomplete").geocomplete({map:"#map-canvas",mapOptions:map_options}).bind("geocode:result",function(t,o){var n=new google.maps.LatLngBounds(o.geometry.viewport.getSouthWest(),o.geometry.viewport.getNorthEast());e.fitBounds(n)}),$("#find").click(function(){$("#autocomplete").trigger("geocode")});var e=$("#autocomplete").geocomplete("map");e.set("streetViewControl",!0),e.mapTypeControl=!1;var t={gridSize:100,batchSize:3e3,batchSizeIE:200,maxZoom:12,averageCenter:!1};mc=new MarkerClusterer(e,[],t),twitterHub.client.BroadcastNewUserToHub=function(e){console.log(e)},twitterHub.client.broadcastTweetMessage=function(t){counter++,$("#tweet-count").html(counter);var o=new google.maps.Marker({map:e,position:new google.maps.LatLng(t.Latitude,t.Longitude),title:t.Text+" by @"+t.User}),n=new google.maps.InfoWindow({content:buildTweetWindow(t)});$("time.timeago").timeago(),google.maps.event.addListener(o,"click",function(){e.panTo(o.getPosition()),n.open(e,o)}),mc.addMarker(o);var a=$("ul.live-tweets li").size(),s=10,r='<li class="tweet-item"><span class="tweet-avatar"><a target="_blank" href="https://www.twitter.com/'+t.User+'"><img alt="'+t.User+'s profile picture" class="img-thumbnail" src="'+t.ImageUrl+'"/></a></span><span class="tweet-content">'+t.Text+'</span><span class="tweet-author">@'+t.User+"</span></li>";s>a?$("ul.live-tweets").prepend(r):($("ul.live-tweets li:last-child").remove(),$("ul.live-tweets").prepend(r))},twitterHub.client.debug=function(e){console.log(e)},twitterHub.client.broadcastLog=function(e){$("#error").modal(),console.log(e)},$.connection.hub.start().done(function(){subscribeGlobalStream(),stopBtn.click(function(e){unsubscribeGlobalStream(),e.preventDefault();var t=new NotificationFx({message:'<span class="icon icon-settings"></span><p>The stream has been stopped. You will not receive any tweets on the map, nor will you be able to see any incoming trends until you restart the stream.</p>',layout:"bar",customClass:"stop",effect:"exploader",ttl:6e3,type:"notice"});t.show()}),startBtn.click(function(e){subscribeGlobalStream(),e.preventDefault();var t=new NotificationFx({message:'<span class="icon icon-settings"></span><p>You have started the stream. Incoming tweets and trends will match the current viewport of the map.</p>',layout:"bar",customClass:"start",effect:"exploader",ttl:6e3,type:"notice"});t.show()})});var o=$.connection.trendsAnalysisHub;o.client.broadcastTrend=function(e){console.log(e)},google.maps.event.addListener(e,"idle",function(t){google.maps.event.addListener(e,"bounds_changed",function(){var e=this.getBounds(),t=e.getSouthWest(),o=e.getNorthEast(),n=new google.maps.LatLng(o.lat(),t.lng()),a=new google.maps.LatLng(t.lat(),o.lng());twitterHub.server.changeStreamBounds({SouthEastLongitude:a.lng(),SouthEastLatitude:a.lat(),NorthWestLongitude:n.lng(),NorthWestLatitude:n.lat()}).done(function(){console.log("Bounds changed")}).fail(function(e){console.log("Bounds change failure. Error: "+e)})})})});